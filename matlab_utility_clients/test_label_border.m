%% Example for using the label_border function

% Set SUBJECTS_DIR to a directory containing fsaverage:
% NOTE: The environment variable has to be set because read_label uses it.
if strlen(getenv("SUBJECTS_DIR")) == 0
  setenv("SUBJECTS_DIR", "/Applications/freesurfer/subjects/"); 
end

subjects_dir = getenv("SUBJECTS_DIR");
subject_id = "fsaverage";
surf = "white";
[verts, faces] = read_surf(fullfile(subjects_dir, subject_id, 'surf', sprintf('lh.%s', surf)));


% Define a patch of vertices
%cluster = mesh_neighborhood(faces+1, [149335], 30);  % growth 8-dist neighbors around central vertex 149335.
cluster = [94 263 455 456 454 523 264 743 995 998 1148 1150 1151 1625 1627 744 1628 2015 994 2016 2017 2018 997 2019 2020 2021 999 2022 2014 2209 1149 2210 2211 1626 2212 1152 2213 2663 2915 2918 3068 3070 3071 3668 3670 3671 3673 4415 4416 4418 4420 4423 4424 4426 4428 4430 4431 4433 4883 4885 4886 4888 4890 4891 4893 4894 4896 5945 5947 2664 5948 6395 2914 6396 6397 6400 2917 6401 6402 6404 2919 6405 6674 6676 3069 6677 6678 6679 6681 3072 6682 7631 7633 3669 7634 7635 5946 7636 3672 7637 7638 7639 3674 7640 8615 4414 8616 8617 6394 8618 4417 8619 8620 8621 4419 8622 8623 8624 4422 8625 8626 6399 8627 4425 8628 8629 8630 4427 8631 8632 8633 4429 8634 8635 6403 8636 4432 8637 8638 8639 4434 8640 8614 9187 4884 9188 9189 6675 9190 4887 9191 9192 9193 4889 9194 9195 7632 9196 4892 9197 9198 6680 9199 4895 9200 9201 9202 4897 9203 10595 10598 10748 10750 11348 11350 12095 12096 12098 12100 12103 12104 12106 12108 12110 12111 12113 12563 12565 12566 12568 12570 12571 12573 13748 13750 14495 14496 14498 14500 14503 14504 14506 14508 14510 14511 14513 14963 14965 14966 14968 14970 14971 14973 16763 16765 16766 16768 16770 16771 16773 16774 16776 16778 16780 18995 18996 18998 19000 19001 19003 19004 19006 19008 19010 19011 19013 19015 19018 19019 19021 19023 19024 19026 19027 19029 19031 19033 19034 19036 19038 19040 19041 19043 19045 19046 19048 19049 19051 19053 19055 19056 19058 20408 20410 20411 20413 20415 20416 20418 20419 20421 20423 20425 20426 20428 20430 20431 20433 20434 20436 20438 20439 20441 20442 20444 20446 20448 23225 23227 23675 10594 23676 23677 23680 10597 23681 23682 23684 10599 23685 23954 23956 10749 23957 23958 23959 23961 25034 25036 11349 25037 25038 25039 25041 11352 25042 25043 25045 26375 12094 26376 26377 26378 26380 12097 26381 26382 26384 12099 26385 26386 26389 12102 26390 26391 26392 26394 12105 26395 26396 26398 12107 26399 26400 26402 12109 26403 26404 26405 26407 12112 26408 26409 26411 12114 26412 27221 27223 12564 27224 27225 27226 27228 12567 27229 27230 27232 12569 27233 27234 27235 27237 12572 27238 27239 27240 27242 12575 27243 27244 27246 29231 29233 13749 29234 29235 23226 29236 13752 29237 29238 29239 30275 14494 30276 30277 23674 30278 14497 30279 30280 30281 14499 30282 30283 30286 14502 30287 30288 23679 30289 14505 30290 30291 30292 14507 30293 30294 30296 14509 30297 30298 23683 30299 14512 30300 30301 30302 14514 30303 30932 30934 14964 30935 30936 23955 30937 14967 30938 30939 30940 14969 30941 30942 30943 30945 14972 30946 30947 23960 30948 14975 30949 30950 30951 33329 33331 16764 33332 33333 25035 33334 16767 33335 33336 33337 16769 33338 33339 29232 33340 16772 33341 33342 25040 33343 16775 33344 33345 33346 16777 33347 33348 33349 16779 33350 33351 25044 33352 16782 33353 33354 33355 36095 18994 36096 36097 26374 36098 18997 36099 36100 36101 18999 36102 36103 30274 36104 19002 36105 36106 26379 36107 19005 36108 36109 36110 19007 36111 36112 36113 19009 36114 36115 26383 36116 19012 36117 36118 36119 19014 36120 36121 36122 19017 36123 36124 26388 36125 19020 36126 36127 36128 19022 36129 36130 30285 36131 19025 36132 36133 26393 36134 19028 36135 36136 36137 19030 36138 36139 36140 19032 36141 36142 26397 36143 19035 36144 36145 36146 19037 36147 36148 36149 19039 36150 36151 26401 36152 19042 36153 36154 36155 19044 36156 36157 30295 36158 19047 36159 36160 26406 36161 19050 36162 36163 36164 19052 36165 36166 36167 19054 36168 36169 26410 36170 19057 36171 36172 36173 19059 36174 20409 37802 27222 37804 20412 37805 37806 20414 37808 30933 37810 20417 37811 37812 27227 37813 20420 37814 37815 37816 20422 37817 37818 20424 37820 27231 37822 20427 37823 37824 20429 37826 33330 37828 20432 37829 37830 27236 37831 20435 37832 37833 37834 20437 37835 37836 30944 37837 20440 37838 37839 27241 37840 20443 37841 37842 37843 20445 37844 37845 37846 20447 37847 37848 27245 37849 20450 37850 37851 37852 41315 41468 41470 42068 42070 42815 42816 42818 42820 42823 42824 42826 42828 42830 43283 43285 43286 43288 43290 43291 43293 44468 44470 45215 45216 45218 45220 45223 45224 45226 45228 45230 45683 45685 45686 45688 45690 45691 45693 47483 47485 47486 47488 47490 47491 47493 47494 47496 47498 47500 49715 49716 49718 49720 49721 49723 49724 49726 49728 49730 49731 49733 49735 49738 49739 49741 49743 49744 49746 49747 49749 49751 49753 49754 49756 49758 49760 49761 49763 49765 49766 49768 49769 49771 49773 49775 51128 51130 51131 51133 51135 51136 51138 51139 51141 51143 51145 51146 51148 51150 51151 51153 51154 51156 51158 51159 51161 51162 51164 51166 51168 54068 54070 54815 54816 54818 54820 54823 54824 54826 54828 54830 55283 55285 55286 55288 55290 55291 55293 57083 57085 57086 57088 57090 57091 57093 57094 57096 57098 57100 59315 59316 59318 59320 59321 59323 59324 59326 59328 59330 59331 59333 59335 59338 59339 59341 59343 59344 59346 59347 59349 59351 59353 59354 59356 59358 59360 59361 59363 59365 59366 59368 59369 59371 59373 59375 60728 60730 60731 60733 60735 60736 60738 60739 60741 60743 60745 60746 60748 60750 60751 60753 60754 60756 60758 60759 60761 60762 60764 60766 60768 64283 64285 64286 64288 64290 64291 64293 64294 64296 64298 64300 66515 66516 66518 66520 66521 66523 66524 66526 66528 66530 66531 66533 66535 66538 66539 66541 66543 66544 66546 66547 66549 66551 66553 66554 66556 66558 66560 66561 66563 66565 66566 66568 66569 66571 66573 66575 67928 67930 67931 67933 67935 67936 67938 67939 67941 67943 67945 67946 67948 67950 67951 67953 67954 67956 67958 67959 67961 67962 67964 67966 67968 73328 73330 73331 73333 73335 73336 73338 73339 73341 73343 73345 73346 73348 73350 73351 73353 73354 73356 73358 73359 73361 73362 73364 73366 73368 73369 73371 73373 73375 73376 73378 73380 73381 73383 73384 73386 73388 73390 80015 80016 80018 80020 80021 80023 80024 80026 80028 80030 80031 80033 80035 80036 80038 80039 80041 80043 80044 80046 80047 80049 80051 80053 80054 80056 80058 80060 80061 80063 80065 80066 80068 80069 80071 80073 80075 80076 80078 80080 80083 80084 80086 80088 80089 80091 80092 80094 80096 80098 80099 80101 80103 80104 80106 80107 80109 80111 80112 80114 80115 80117 80119 80121 80122 80124 80126 80128 80129 80131 80133 80134 80136 80137 80139 80141 80143 80144 80146 80148 80150 80151 80153 80155 80156 80158 80159 80161 80163 80165 80166 80168 80170 80171 80173 80174 80176 80178 80179 80181 80182 80184 80186 80188 80189 80191 80193 80195 80196 80198 80200 80201 80203 80204 80206 80208 80210 84263 84265 84266 84268 84270 84271 84273 84274 84276 84278 84280 84281 84283 84285 84286 84288 84289 84291 84293 84294 84296 84297 84299 84301 84303 84304 84306 84308 84310 84311 84313 84315 84316 84318 84319 84321 84323 84325 84326 84328 84330 84331 84333 84334 84336 84338 84339 84341 84342 84344 84346 84348 84349 84351 84353 84354 84356 84357 84359 84361 84362 84364 84365 84367 84369 84371 84372 84374 84376 84378 84379 84381 84383 84384 84386 84387 84389 84391 84393 92345 92795 92796 92797 92800 92801 92802 92804 93074 93076 41469 93077 93078 93079 94154 94156 42069 94157 94158 94159 94161 94162 94163 95495 95496 95497 95498 95500 42817 95501 95502 95504 42819 95505 95506 95509 95510 95511 95512 95514 42825 95515 95516 95518 42827 95519 95520 95522 42829 95523 95524 95525 95527 42832 95528 95529 95531 96341 96343 43284 96344 96345 96346 96348 43287 96349 96350 96352 43289 96353 96354 96355 96357 43292 96358 96359 96360 96362 96363 96364 98474 98476 44469 98477 98478 98479 98481 98482 98483 99815 99816 99817 99818 99820 45217 99821 99822 99824 45219 99825 99826 99829 99830 99831 99832 99834 45225 99835 99836 99838 45227 99839 99840 99842 45229 99843 99844 99845 99847 45232 99848 99849 99851 100661 100663 45684 100664 100665 100666 100668 45687 100669 100670 100672 45689 100673 100674 100675 100677 45692 100678 100679 100680 100682 100683 100684 103901 103903 47484 103904 103905 103906 103908 47487 103909 103910 103912 47489 103913 103914 103915 103917 47492 103918 103919 103920 103922 47495 103923 103924 103926 47497 103927 103928 103930 47499 103931 103932 103933 103935 103936 103937 107915 107916 107917 107918 107920 49717 107921 107922 107924 49719 107925 107926 107927 107929 49722 107930 107931 107932 107934 49725 107935 107936 107938 49727 107939 107940 107942 49729 107943 107944 107945 107947 49732 107948 107949 107951 49734 107952 107953 107956 107957 107958 107959 107961 49740 107962 107963 107965 49742 107966 107967 107968 107970 49745 107971 107972 107973 107975 49748 107976 107977 107979 49750 107980 107981 107983 49752 107984 107985 107986 107988 49755 107989 107990 107992 49757 107993 107994 107996 49759 107997 107998 107999 108001 49762 108002 108003 108005 49764 108006 108007 108008 108010 49767 108011 108012 108013 108015 49770 108016 108017 108019 49772 108020 108021 108023 49774 108024 108025 108026 108028 49777 108029 108030 108032 110462 110464 51129 110465 110466 110467 110469 51132 110470 110471 110473 51134 110474 110475 110476 110478 51137 110479 110480 110481 110483 51140 110484 110485 110487 51142 110488 110489 110491 51144 110492 110493 110494 110496 51147 110497 110498 110500 51149 110501 110502 110503 110505 51152 110506 110507 110508 110510 51155 110511 110512 110514 51157 110515 110516 110517 110519 51160 110520 110521 110522 110524 51163 110525 110526 110528 51165 110529 110530 110532 51167 110533 110534 110535 110537 110538 110539 115631 115633 54069 115634 115635 92346 115636 115637 115638 116675 116676 116677 116678 54817 116679 116680 116681 54819 116682 116683 116686 116687 116688 116689 54825 116690 116691 116692 54827 116693 116694 116696 54829 116697 116698 92803 116699 54832 116700 116701 116702 117332 117334 55284 117335 117336 93075 117337 55287 117338 117339 117340 55289 117341 117342 117343 117345 55292 117346 117347 93080 117348 117349 117350 119852 119854 57084 119855 119856 94155 119857 57087 119858 119859 119860 57089 119861 119862 119863 119865 57092 119866 119867 94160 119868 57095 119869 119870 119871 57097 119872 119873 119875 57099 119876 119877 94164 119878 119879 119880 122975 122976 122977 122978 59317 122979 122980 122981 59319 122982 122983 122984 122986 59322 122987 122988 95499 122989 59325 122990 122991 122992 59327 122993 122994 122996 59329 122997 122998 95503 122999 59332 123000 123001 123002 59334 123003 123004 123007 123008 123009 123010 59340 123011 123012 123013 59342 123014 123015 123016 123018 59345 123019 123020 95513 123021 59348 123022 123023 123024 59350 123025 123026 123028 59352 123029 123030 95517 123031 59355 123032 123033 123034 59357 123035 123036 123038 59359 123039 123040 95521 123041 59362 123042 123043 123044 59364 123045 123046 123047 123049 59367 123050 123051 95526 123052 59370 123053 123054 123055 59372 123056 123057 123059 59374 123060 123061 95530 123062 59377 123063 123064 123065 124955 124957 60729 124958 124959 96342 124960 60732 124961 124962 124963 60734 124964 124965 124966 124968 60737 124969 124970 96347 124971 60740 124972 124973 124974 60742 124975 124976 124978 60744 124979 124980 96351 124981 60747 124982 124983 124984 60749 124985 124986 124987 124989 60752 124990 124991 96356 124992 60755 124993 124994 124995 60757 124996 124997 124998 125000 60760 125001 125002 96361 125003 60763 125004 125005 125006 60765 125007 125008 125010 60767 125011 125012 96365 125013 125014 125015 129809 129811 64284 129812 129813 98475 129814 64287 129815 129816 129817 64289 129818 129819 115632 129820 64292 129821 129822 98480 129823 64295 129824 129825 129826 64297 129827 129828 129829 64299 129830 129831 98484 129832 129833 129834 132635 132636 132637 132638 66517 132639 132640 132641 66519 132642 132643 132644 66522 132645 132646 99819 132647 66525 132648 132649 132650 66527 132651 132652 132653 66529 132654 132655 99823 132656 66532 132657 132658 132659 66534 132660 132661 132664 132665 132666 132667 66540 132668 132669 132670 66542 132671 132672 132673 66545 132674 132675 99833 132676 66548 132677 132678 132679 66550 132680 132681 132682 66552 132683 132684 99837 132685 66555 132686 132687 132688 66557 132689 132690 132692 66559 132693 132694 99841 132695 66562 132696 132697 132698 66564 132699 132700 116695 132701 66567 132702 132703 99846 132704 66570 132705 132706 132707 66572 132708 132709 132710 66574 132711 132712 99850 132713 66577 132714 132715 132716 134426 134428 67929 134429 134430 100662 134431 67932 134432 134433 134434 67934 134435 134436 117333 134437 67937 134438 134439 100667 134440 67940 134441 134442 134443 67942 134444 134445 134446 67944 134447 134448 100671 134449 67947 134450 134451 134452 67949 134453 134454 134455 134457 67952 134458 134459 100676 134460 67955 134461 134462 134463 67957 134464 134465 117344 134466 67960 134467 134468 100681 134469 67963 134470 134471 134472 67965 134473 134474 134475 67967 134476 134477 100685 134478 134479 134480 141143 141145 73329 141146 141147 103902 141148 73332 141149 141150 141151 73334 141152 141153 119853 141154 73337 141155 141156 103907 141157 73340 141158 141159 141160 73342 141161 141162 141163 73344 141164 141165 103911 141166 73347 141167 141168 141169 73349 141170 141171 129810 141172 73352 141173 141174 103916 141175 73355 141176 141177 141178 73357 141179 141180 119864 141181 73360 141182 141183 103921 141184 73363 141185 141186 141187 73365 141188 141189 141190 73367 141191 141192 103925 141193 73370 141194 141195 141196 73372 141197 141198 141199 73374 141200 141201 103929 141202 73377 141203 141204 141205 73379 141206 141207 119874 141208 73382 141209 141210 103934 141211 73385 141212 141213 141214 73387 141215 141216 141217 73389 141218 141219 103938 141220 141221 141222 149256 149257 149258 80017 149259 149260 149261 80019 149262 149263 149264 80022 149265 149266 107919 149267 80025 149268 149269 149270 80027 149271 149272 149273 80029 149274 149275 107923 149276 80032 149277 149278 149279 80034 149280 149281 149282 80037 149283 149284 107928 149285 80040 149286 149287 149288 80042 149289 149290 122985 149291 80045 149292 149293 107933 149294 80048 149295 149296 149297 80050 149298 149299 149300 80052 149301 149302 107937 149303 80055 149304 149305 149306 80057 149307 149308 149309 80059 149310 149311 107941 149312 80062 149313 149314 149315 80064 149316 149317 122995 149318 80067 149319 149320 107946 149321 80070 149322 149323 149324 80072 149325 149326 149327 80074 149328 149329 107950 149330 80077 149331 149332 149333 80079 149334 149335 149336 149337 149338 149339 80085 149340 149341 149342 80087 149343 149344 149345 80090 149346 149347 107960 149348 80093 149349 149350 149351 80095 149352 149353 149354 80097 149355 149356 107964 149357 80100 149358 149359 149360 80102 149361 149362 149363 80105 149364 149365 107969 149366 80108 149367 149368 149369 80110 149370 149371 123017 149372 80113 149373 149374 107974 149375 80116 149376 149377 149378 80118 149379 149380 149381 80120 149382 149383 107978 149384 80123 149385 149386 149387 80125 149388 149389 149390 80127 149391 149392 107982 149393 80130 149394 149395 149396 80132 149397 149398 123027 149399 80135 149400 149401 107987 149402 80138 149403 149404 149405 80140 149406 149407 149408 80142 149409 149410 107991 149411 80145 149412 149413 149414 80147 149415 149416 149417 80149 149418 149419 107995 149420 80152 149421 149422 149423 80154 149424 149425 123037 149426 80157 149427 149428 108000 149429 80160 149430 149431 149432 80162 149433 149434 149435 80164 149436 149437 108004 149438 80167 149439 149440 149441 80169 149442 149443 132691 149444 80172 149445 149446 108009 149447 80175 149448 149449 149450 80177 149451 149452 123048 149453 80180 149454 149455 108014 149456 80183 149457 149458 149459 80185 149460 149461 149462 80187 149463 149464 108018 149465 80190 149466 149467 149468 80192 149469 149470 149471 80194 149472 149473 108022 149474 80197 149475 149476 149477 80199 149478 149479 123058 149480 80202 149481 149482 108027 149483 80205 149484 149485 149486 80207 149487 149488 149489 80209 149490 149491 108031 149492 80212 149493 149494 149495 110463 154366 84267 154367 124956 154372 84272 154373 154374 110468 154375 84275 154376 154377 154378 84277 154379 110472 154384 84282 154385 134427 154390 84287 154391 154392 110477 154393 84290 154394 154395 154396 84292 154397 154398 124967 154399 84295 154400 154401 110482 154402 84298 154403 154404 154405 84300 154406 154407 154408 84302 154409 154410 110486 154411 84305 154412 154413 154414 84307 154415 110490 154420 84312 154421 124977 154426 84317 154427 154428 110495 154429 84320 154430 154431 154432 84322 154433 110499 154438 84327 154439 141144 154444 84332 154445 154446 110504 154447 84335 154448 154449 154450 84337 154451 154452 124988 154453 84340 154454 154455 110509 154456 84343 154457 154458 154459 84345 154460 154461 154462 84347 154463 154464 110513 154465 84350 154466 154467 154468 84352 154469 154470 134456 154471 84355 154472 154473 110518 154474 84358 154475 154476 154477 84360 154478 154479 124999 154480 84363 154481 154482 110523 154483 84366 154484 154485 154486 84368 154487 154488 154489 84370 154490 154491 110527 154492 84373 154493 154494 154495 84375 154496 154497 154498 84377 154499 154500 110531 154501 84380 154502 154503 154504 84382 154505 154506 125009 154507 84385 154508 154509 110536 154510 84388 154511 154512 154513 84390 154514 154515 154516 84392 154517 154518 110540 154519 154520 154521 84264 37801 84269 37803 84279 37807 84284 37809 84309 37819 84314 37821 84324 37825 84329 149255 36094 41314 41317 42814 42822 45214 45222 49714 49737 54814 92794 54822 92799 59314 95494 59337 95508 66514 99814 116674 66537 99828 116685 80014 107914 122974 132634 80082 107955 123006 132663];
border_vertices = label_border(verts, faces+1, cluster);  % Note the faces+1, as the indices are zero-based when loaded from the file. Matlab uses 1-based indexing.


% Visualization examples follow.
% Visualization is not part of this function, but very useful to
% judge the output (and usually the reason why one calls the label_border
% function).

% Load a surface for visualization
subject_surf_dir = fullfile(subjects_dir, subject_id, 'surf');
lh_display_surf_file = fullfile(subject_surf_dir, strcat('lh.', surf));
rh_display_surf_file = fullfile(subject_surf_dir, strcat('rh.', surf));
display_surface = SurfStatReadSurf ( {lh_display_surf_file, rh_display_surf_file} );
hemi = 'both';
colormap_binary = [1 1 1; 1 0 0];

% Draw the full patch onto an empty surface
cluster_data = ones(1, size(verts, 1)*2);  % factor 2 is for the both hemis
cluster_data(cluster) = 2;
figure;
SurfStatView(cluster_data, display_surface, 'Label border on flat surface');
SurfStatColormap(colormap_binary);

% Draw the border onto an empty surface
cluster_border_data = ones(1, size(verts, 1)*2);  % factor 2 is for the both hemis
cluster_border_data(border_vertices) = 2;
figure;
SurfStatView(cluster_border_data, display_surface, 'Label border on flat surface');
SurfStatColormap(colormap_binary);



% Draw the border together with cortical thickness data. 
measure = 'thickness';
measure_data = read_subject_data(subject_id, subjects_dir, measure, 'white', hemi);
measure_data(border_vertices) = 0.; % or whatever value to see it.
figure;
SurfStatView(measure_data, display_surface, 'Label border on CT data');